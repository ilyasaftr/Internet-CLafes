CREATE DATABASE `internet-clafes`;
USE `internet-clafes`;

CREATE TABLE `User` (
	UserID INT AUTO_INCREMENT PRIMARY KEY,
    UserName VARCHAR(255) NOT NULL,
    UserPassword VARCHAR(255) NOT NULL,
    UserAge INT NOT NULL,
    UserRole VARCHAR(255) NOT NULL
);

CREATE TABLE `PC`(
	PC_ID INT AUTO_INCREMENT PRIMARY KEY,
	PC_Condition VARCHAR(255) NOT NULL
);

CREATE TABLE `Job`(
	Job_ID INT AUTO_INCREMENT PRIMARY KEY,
    UserID INT NOT NULL,
    PC_ID INT NOT NULL,
    JobStatus VARCHAR(255) NOT NULL,
    
    FOREIGN KEY (`UserID`) REFERENCES `User`(`UserID`) ON UPDATE CASCADE ON DELETE CASCADE,
    FOREIGN KEY (`PC_ID`) REFERENCES `PC`(`PC_ID`) ON UPDATE CASCADE ON DELETE CASCADE
);

CREATE TABLE `Report`(
	Report_ID INT AUTO_INCREMENT PRIMARY KEY,
    UserRole VARCHAR(255) NOT NULL,
    PC_ID INT NOT NULL,
    ReportNote TEXT NOT NULL,
    ReportDate DATE NOT NULL,
    UserID INT NOT NULL,
    
    FOREIGN KEY (`UserID`) REFERENCES `User`(`UserID`) ON UPDATE CASCADE ON DELETE CASCADE
);

CREATE TABLE `TransactionHeader`(
	TransactionID INT AUTO_INCREMENT PRIMARY KEY,
    StaffID INT NOT NULL,
    StaffName VARCHAR(255) NOT NULL,
    TransactionDate DATE NOT NULL,
    
    FOREIGN KEY (`StaffID`) REFERENCES `User`(`UserID`) ON UPDATE CASCADE ON DELETE CASCADE
);

CREATE TABLE `TransactionDetail`(
    TransactionID INT NOT NULL,
    PC_ID INT NOT NULL,
    CustomerName VARCHAR(255) NOT NULL,
    BookedTime TIME NOT NULL,
    
    FOREIGN KEY (`TransactionID`) REFERENCES `TransactionHeader`(`TransactionID`) ON UPDATE CASCADE ON DELETE CASCADE,
    FOREIGN KEY (`PC_ID`) REFERENCES `PC`(`PC_ID`) ON UPDATE CASCADE ON DELETE CASCADE,
    
    PRIMARY KEY (TransactionID, PC_ID)
);

CREATE TABLE `PCBook`(
	Book_ID INT AUTO_INCREMENT PRIMARY KEY,
    PC_ID INT NOT NULL,
    UserID INT NOT NULL,
    BookedDate DATE NOT NULL,
    TransactionID INT NOT NULL,
    
    FOREIGN KEY (`TransactionID`, `PC_ID`) REFERENCES `TransactionDetail`(`TransactionID`, `PC_ID`) ON UPDATE CASCADE ON DELETE CASCADE
);